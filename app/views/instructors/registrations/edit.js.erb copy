$(".notice").empty();
$(".alert").empty();
$(".ujs_alert").html("<%= @ujsAlert %>");
$(".ujs_notice").html("<%= @ujsNotice %>");
$("article").replaceWith("<%= j render 'shared/edit_registration' %>");

$("input.autocomplete-field").each(function(index) {
  $(this).autocomplete({
  minLength: 0,
  delay: 0,
  source: $(this).data("autocomplete-source")},
 {
  messages: {
    noResults: '',
    results: ''
  },
  select: function(event, ui) {
    var info;
    info = ui.item.value.split("||");
    ui.item.value = info[0];
    $(this).val(info[0]);
    $(this).next("input").val(info[1]);
    return $(this).next("input").next("input").val(info[2]);
    }
  });
});

setupAddRemoveFields();

$("#update-button").click(function(){
  var new_schools = "";
  var new_school_count = 0;
  $("div.school-memberships").each(function(index){
    fields = $(this).find("input");
    var school = fields.eq(0).val();
    var town = fields.eq(1).val();
    var state_abbrev = fields.eq(2).val();
    
    var urlString = window.location.origin + "/schools/exists.json?name="+school+"&town="+town+"&state="+state_abbrev;
    console.log(urlString);
    
    $.getJSON(urlString,
      function(data){
        // if school exists data=1, if not and params are valid data=0, if params are invalid data=-1
        if (data == "0"){
          new_schools = new_schools + "<span class \"title\">" + school + ", " + town + ", " + state_abbrev +"</span></br>";
          new_school_count++;
        }
      })
    });
    if (new_school_count > 0) {     
      var diag_title = "Create a new school?";
      if (new_school_count > 1) {
        diag_title = "Create all of the following new schools?";
      }
      
      $("#create_new_school_dialog").prepend(new_schools);
      $("#create_new_school_dialog").dialog({
    	  title: ,
    	  resizeable: false,
    	  modal: true,
        buttons : {
            "Yes" : function ()
            {
              $("#create_new_school_dialog").dialog("destroy");
              $("#create_new_school_dialog").html("");
              return true;
             },
            "No" : function ()
            {
              $("#create_new_school_dialog").dialog("destroy");
              $("#create_new_school_dialog").html("");
              return false;
            }
          }
        });
      }
      

