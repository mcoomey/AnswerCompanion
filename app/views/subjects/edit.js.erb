$("#ujsform").remove();
ujsMessages("<%= @ujsAlert %>", "<%= @ujsNotice %>");
$("table tr td:nth-child(5) a").fadeTo("fast", 0.3).bind('click', false);
$("table tr td:nth-child(6) a").fadeTo("fast", 0.3).bind('click', false);
$("#buttonarea").hide().after("<%= j render 'edit_subject' %>");
$("#subject_enrollment_attributes__destroy").click(function(e){
  if ($(this).is(":checked")){
    $("#subject_enrollment_attributes__destroy").parent().find("select, input[type=text]").addClass("stricken");
  }
  else {
    $("#subject_enrollment_attributes__destroy").parent().find("select, input[type=text]").removeClass("stricken");
  }
});

var courses, instructor, escaped_instructor, options;
courses = $('#course_select').html();
console.log(courses);
$('#instructor_select').change(function() {
  var instructor, escaped_instructor, options;
  instructor = $('#instructor_select :selected').text();
  idx = $('#instructor_select :selected').index();
  if (idx == 0){
    options = $(courses);
  } else {
    escaped_instructor = instructor.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g, '\\$1');
    options = $(courses).filter("optgroup[label='" + escaped_instructor + "']").html();
  }
  if (options) {
    $('#course_select').fadeTo("fast", 1.0);
    $('#course_select').html(options);
    $("#update-button").fadeTo("fast", 1.0);
    $("#update-button").prop('disabled', false);
    $("#messages .ujs_alert").html("");
  } else {
    $('#course_select').fadeTo("fast", 0.1);
    $('#course_select').empty();
    $("#update-button").fadeTo("fast", 0.1);
    $("#update-button").prop('disabled', true);
    $("#messages .ujs_alert").html("Instructor " + instructor + " has not published any courses.");
  }
});

$('form').on('click', '.add_enrollment', function(event) {
  var regexp, time;
  time = new Date().getTime();
  regexp = new RegExp($(this).data('id'), 'g');
  $(this).replaceWith($(this).data('fields').replace(regexp, time));
  
  courses = $('#course_select').html();
  console.log(courses);
  $('#instructor_select').change(function() {
    var instructor, escaped_instructor, options;
    instructor = $('#instructor_select :selected').text();
    idx = $('#instructor_select :selected').index();
    if (idx == 0){
      options = $(courses);
    } else {
      escaped_instructor = instructor.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g, '\\$1');
      options = $(courses).filter("optgroup[label='" + escaped_instructor + "']").html();
    }
    if (options) {
      $('#course_select').fadeTo("fast", 1.0);
      $('#course_select').html(options);
      $("#update-button").fadeTo("fast", 1.0);
      $("#update-button").prop('disabled', false);
      $("#messages .ujs_alert").html("");
    } else {
      $('#course_select').fadeTo("fast", 0.1);
      $('#course_select').empty();
      $("#update-button").fadeTo("fast", 0.1);
      $("#update-button").prop('disabled', true);
      $("#messages .ujs_alert").html("Instructor " + instructor + " has not published any courses.");
    }
  });
  
  
  return event.preventDefault();
});
